//
//  NSObject+Runtime.m
//  iOSHelper
//
//  Created by Aigo on 14-7-24.
//  Copyright (c) 2014å¹´ pljhonglu. All rights reserved.
//

#import "NSObject+Runtime.h"

@implementation NSObject (Runtime)
+ (NSString *)className{
    return [NSString stringWithUTF8String:class_getName(self)];
}
- (NSString *)className{
    return [NSString stringWithUTF8String:object_getClassName(self)];
}
- (void)dictionaryForObject:(NSDictionary*) dict{
    for (NSString *key in [dict allKeys]) {
        id value = [dict objectForKey:key];
        
        if (value==[NSNull null]) {
            continue;
        }
        if ([value isKindOfClass:[NSDictionary class]]) {
            id subObj = [self valueForKey:key];
            if (subObj)
                [subObj dictionaryForObject:value];
        }
        else{
            [self setValue:value forKeyPath:key];
        }
    }
}
- (NSDictionary *)getPropertyDictionary{
    NSMutableDictionary *props = [NSMutableDictionary dictionary];
    unsigned int outCount;
    objc_property_t *properties = class_copyPropertyList([self class], &outCount);
    for (int i = 0; i < outCount; i++) {
        objc_property_t property = properties[i];
        NSString *propertyName = [[NSString alloc] initWithUTF8String:property_getName(property)];
        id propertyValue = [self valueForKey:(NSString *)propertyName];
        if (propertyValue) [props setObject:propertyValue forKey:propertyName];
    }
    free(properties);
    return props;
}

- (NSArray *)getPropertyList:(Class)clazz{
    u_int count;
    objc_property_t *properties = class_copyPropertyList(clazz, &count);
    NSMutableArray *propertyArray = [NSMutableArray arrayWithCapacity:count];
    
    for (int i = 0; i < count ; i++)
    {
        const char* propertyName = property_getName(properties[i]);
        [propertyArray addObject: [NSString stringWithUTF8String: propertyName]];
    }
    free(properties);
    return propertyArray;
}

@end
